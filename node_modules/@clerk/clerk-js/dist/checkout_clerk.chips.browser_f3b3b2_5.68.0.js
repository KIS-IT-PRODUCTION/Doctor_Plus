"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["237"],{670:function(e,t,r){r.r(t),r.d(t,{Checkout:()=>G});var o=r(9109),i=r(1102),a=r(111),n=r(9541),l=r(9144),c=r(8e3),s=r(3003),d=r(2464),u=r(4676),m=r(43),p=r(3799),h=r(9626),y=r(903);let f=(0,l.createContext)(null),g=()=>{let e=(0,l.useContext)(f);if(!e)throw Error("CheckoutContextRoot not found");return e},k=()=>{let{planId:e,planPeriod:t,subscriberType:r="user",onSubscriptionComplete:o}=(0,a.useCheckoutContext)(),i=(0,p.cL)(),{organization:n}=(0,p.o8)(),{user:c}=(0,p.aF)(),s={key:"commerce-checkout",userId:c?.id,arguments:{..."org"===r?{orgId:n?.id}:{},planId:e,planPeriod:t}},{data:d,mutate:u}=(0,h.default)(s),{trigger:m,isMutating:f,error:g}=(0,y.Z)(s,e=>i.billing?.startCheckout(e.arguments),{throwOnError:!1,onSuccess:e=>{u(e,!1)}});return(0,l.useEffect)(()=>(m(),()=>{u(void 0,!1)}),[]),{checkout:d,startCheckout:m,updateCheckout:e=>{u(e,!1),o?.()},isMutating:f,errors:g?.errors}},x=({children:e})=>{let{planId:t}=(0,a.useCheckoutContext)(),{data:r,isLoading:i}=(0,a.usePlans)(),{checkout:n,isMutating:c,updateCheckout:s,errors:d,startCheckout:u}=k(),m=r?.find(e=>e.id===t),p=c||i,h=(0,l.useMemo)(()=>{if(p)return"pending";let e="completed";if(n?.status===e)return e;if(n)return"ready";let t="missing_payer_email";if(d?.some(e=>e.code===t))return t;let r="invalid_plan_change";return d?.[0]?.code===r&&m?r:"error"},[p,d,n,m?.id,n?.status]);return(0,o.tZ)(f.Provider,{value:{checkout:n,isLoading:p,updateCheckout:s,errors:d,startCheckout:u,plan:m,status:h},children:e})},b=({children:e,name:t})=>g().status!==t?null:e,S=e=>e[0].toUpperCase()+e.slice(1),Z=(e,t,r)=>e+(t-e)*r,$=()=>{let e=(0,u.useRouter)(),{setIsOpen:t}=(0,i.useDrawerContext)(),{newSubscriptionRedirectUrl:r}=(0,a.useCheckoutContext)(),{checkout:p}=g(),[h,y]=(0,l.useState)({x:256,y:256}),[f,k]=(0,l.useState)({x:256,y:256}),x=(0,d.Tb)(),{animations:b}=(0,n.useAppearance)().parsedLayout,$=!x&&!0===b,w=(0,l.useRef)(null),B=(0,l.useRef)(null),v="undefined"==typeof window||window.matchMedia("(hover: hover) and (pointer: fine)").matches;return((0,l.useEffect)(()=>{if(!v)return;let e=()=>{k(e=>({x:Z(e.x,h.x,.15),y:Z(e.y,h.y,.15)})),w.current=requestAnimationFrame(e)};return w.current=requestAnimationFrame(e),()=>{w.current&&cancelAnimationFrame(w.current)}},[h,v]),p)?(0,o.BX)(o.HY,{children:[(0,o.tZ)(i.Drawer.Body,{children:(0,o.BX)(n.Span,{elementDescriptor:n.descriptors.checkoutSuccessRoot,sx:e=>({"--ring-fill":e.colors.$neutralAlpha200,"--ring-highlight":e.colors.$success500,margin:"auto",position:"relative",aspectRatio:"1/1",display:"grid",width:"100%",padding:e.space.$4,flexShrink:0,transformOrigin:"bottom center",animationName:"scaleIn",animationDuration:`${s.bf.slowest}ms`,animationTimingFunction:s.$$.bezier,animationFillMode:"forwards",opacity:0,overflow:"hidden",backgroundColor:e.colors.$colorBackground,"@keyframes scaleIn":{"0%":{filter:"blur(10px)",transform:"scale(0.85)",opacity:0},"100%":{filter:"blur(0px)",transform:"scale(1)",opacity:1}},...!$&&{animation:"none",opacity:1}}),ref:B,onMouseMove:e=>{if(v&&B.current){let t=B.current.getBoundingClientRect(),r=e.clientX-t.left,o=e.clientY-t.top,i=t.width;i>0?y({x:r/i*512,y:o/i*512}):y({x:256,y:256})}},children:[(0,o.BX)(n.Box,{elementDescriptor:n.descriptors.checkoutSuccessRings,as:"svg",viewBox:"0 0 512 512",sx:{position:"absolute",inset:0,pointerEvents:"none"},"aria-hidden":!0,children:[(0,o.BX)("defs",{children:[(0,o.BX)("radialGradient",{id:"clerk-checkout-success-gradient",children:[(0,o.tZ)("stop",{offset:"0%",style:{stopColor:"var(--ring-highlight)"}}),(0,o.tZ)("stop",{offset:"100%",stopOpacity:"0",style:{stopColor:"var(--ring-highlight)"}})]}),(0,o.tZ)("filter",{id:"clerk-checkout-success-blur-effect",children:(0,o.tZ)("feGaussianBlur",{stdDeviation:"10"})}),(0,o.tZ)("mask",{id:"clerk-checkout-success-mask",children:[{r:225,maskStart:10,maskEnd:90},{r:162.5,maskStart:15,maskEnd:85},{r:100,maskStart:20,maskEnd:80}].map(({r:e,maskStart:t,maskEnd:r})=>(0,o.tZ)("circle",{cx:"256",cy:"256",r:e,stroke:"white",fill:"none",style:{maskImage:`linear-gradient(to bottom, transparent ${t}%, black, transparent ${r}%)`}},e))})]}),(0,o.BX)("g",{mask:"url(#clerk-checkout-success-mask)",children:[(0,o.tZ)("rect",{width:"512",height:"512",style:{fill:"var(--ring-fill)"}}),v&&(0,o.tZ)("rect",{id:"movingGradientHighlight",width:"256",height:"256",x:f.x-128,y:f.y-128,fill:"url(#clerk-checkout-success-gradient)",filter:"url(#clerk-checkout-success-blur-effect)"})]})]}),(0,o.BX)(n.Box,{elementDescriptor:n.descriptors.checkoutSuccessBadge,sx:e=>({margin:"auto",gridArea:"1/1",display:"flex",position:"relative",width:e.sizes.$16,height:e.sizes.$16,borderRadius:e.radii.$circle,backgroundImage:"linear-gradient(180deg, rgba(255, 255, 255, 0.30) 0%, rgba(0, 0, 0, 0.12) 50%, rgba(0, 0, 0, 0.30) 95.31%)",boxShadow:"0px 4px 12px 0px rgba(0, 0, 0, 0.35), 0px 1px 0px 0px rgba(255, 255, 255, 0.05) inset",color:v?e.colors.$success500:e.colors.$colorText,":before":{content:'""',position:"absolute",inset:e.space.$1,borderRadius:e.radii.$circle,backgroundColor:e.colors.$colorBackground}}),children:[(0,o.tZ)("svg",{fill:"none",viewBox:"0 0 10 10","aria-hidden":"true",style:{position:"relative",margin:"auto",width:"1rem",height:"1rem"},children:(0,o.tZ)("path",{d:"m1 6 3 3 5-8",stroke:"currentColor",strokeWidth:"1.25",strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"1",pathLength:"1",style:{strokeDashoffset:"1",animation:$?`check ${s.bf.drawer}ms ${s.$$.bezier} forwards ${s.bf.slow}ms`:"none",...!$&&{strokeDashoffset:"0"}}})}),(0,o.tZ)("style",{children:`
              @keyframes check {
                0% {
                  stroke-dashoffset: 1;
                }
                100% {
                  stroke-dashoffset: 0;
                }
            `})]}),(0,o.BX)(n.Span,{sx:e=>({margin:"auto",gridArea:"1/1",position:"relative",textAlign:"center",transform:`translateY(${e.space.$20})`}),children:[(0,o.tZ)(n.Heading,{elementDescriptor:n.descriptors.checkoutSuccessTitle,as:"h2",textVariant:"h2",localizationKey:p.totals.totalDueNow.amount>0?(0,n.localizationKeys)("commerce.checkout.title__paymentSuccessful"):(0,n.localizationKeys)("commerce.checkout.title__subscriptionSuccessful"),sx:e=>({opacity:0,animationName:"slideUp",animationDuration:`${s.bf.slowest}ms`,animationTimingFunction:s.$$.bezier,animationFillMode:"forwards",color:e.colors.$colorText,"@keyframes slideUp":{"0%":{transform:"translateY(30px)",opacity:0},"100%":{transform:"translateY(0)",opacity:1}},...!$&&{opacity:1,animation:"none"}})}),(0,o.tZ)(n.Text,{elementDescriptor:n.descriptors.checkoutSuccessDescription,colorScheme:"secondary",sx:e=>({textAlign:"center",paddingInline:e.space.$8,marginBlockStart:e.space.$2,opacity:0,animationName:"slideUp",animationDuration:`${1.5*s.bf.slowest}ms`,animationTimingFunction:s.$$.bezier,animationFillMode:"forwards","@keyframes slideUp":{"0%":{transform:"translateY(30px)",opacity:0},"100%":{transform:"translateY(0)",opacity:1}},...!$&&{opacity:1,animation:"none"}}),localizationKey:p.totals.totalDueNow.amount>0?(0,n.localizationKeys)("commerce.checkout.description__paymentSuccessful"):(0,n.localizationKeys)("commerce.checkout.description__subscriptionSuccessful")})]})]})}),(0,o.BX)(i.Drawer.Footer,{sx:e=>({rowGap:e.space.$4,animationName:"footerSlideInUp",animationDuration:`${s.bf.drawer}ms`,animationTimingFunction:s.$$.bezier,"@keyframes footerSlideInUp":{"0%":{transform:"translateY(100%)",opacity:0},"100%":{transform:"translateY(0)",opacity:1}},...!$&&{animation:"none"}}),children:[(0,o.BX)(c.a.Root,{children:[(0,o.BX)(c.a.Group,{variant:"secondary",children:[(0,o.tZ)(c.a.Title,{title:(0,n.localizationKeys)("commerce.checkout.lineItems.title__totalPaid")}),(0,o.tZ)(c.a.Description,{text:`${p.totals.totalDueNow.currencySymbol}${p.totals.totalDueNow.amountFormatted}`})]}),(0,o.BX)(c.a.Group,{variant:"secondary",children:[(0,o.tZ)(c.a.Title,{title:p.totals.totalDueNow.amount>0?(0,n.localizationKeys)("commerce.checkout.lineItems.title__paymentMethod"):(0,n.localizationKeys)("commerce.checkout.lineItems.title__subscriptionBegins")}),(0,o.tZ)(c.a.Description,{text:p.totals.totalDueNow.amount>0?p.paymentSource?"card"!==p.paymentSource.paymentMethod?`${S(p.paymentSource.paymentMethod)}`:`${S(p.paymentSource.cardType)} ⋯ ${p.paymentSource.last4}`:"–":p.planPeriodStart?(0,m.p6)(new Date(p.planPeriodStart)):"–"})]})]}),(0,o.tZ)(n.Button,{onClick:()=>{r&&e.navigate(r),t&&t(!1)},localizationKey:(0,n.localizationKeys)("formButtonPrimary")})]})]}):null};var w=r(4455),B=r(2672),v=r(7291),C=r(3146),D=r(2189),z=r(6958),_=r(8057),K=r(7106);let P=e=>e[0].toUpperCase()+e.slice(1),A=(0,B.withCardStateProvider)(()=>{let{checkout:e}=g();if(!e)return null;let{plan:t,planPeriod:r,totals:a,isImmediatePlanChange:l}=e,s=!!a.credit?.amount&&a.credit.amount>0,d=!!a.pastDue?.amount&&a.pastDue.amount>0;return(0,o.BX)(i.Drawer.Body,{children:[(0,o.tZ)(n.Box,{elementDescriptor:n.descriptors.checkoutFormLineItemsRoot,sx:e=>({padding:e.space.$4,borderBottomWidth:e.borderWidths.$normal,borderBottomStyle:e.borderStyles.$solid,borderBottomColor:e.colors.$neutralAlpha100}),children:(0,o.BX)(c.a.Root,{children:[(0,o.BX)(c.a.Group,{children:[(0,o.tZ)(c.a.Title,{title:t.name,description:"annual"===r?(0,n.localizationKeys)("commerce.billedAnnually"):void 0}),(0,o.tZ)(c.a.Description,{prefix:"annual"===r?"x12":void 0,text:`${t.currencySymbol}${"month"===r?t.amountFormatted:t.annualMonthlyAmountFormatted}`,suffix:(0,n.localizationKeys)("commerce.checkout.perMonth")})]}),(0,o.BX)(c.a.Group,{borderTop:!0,variant:"tertiary",children:[(0,o.tZ)(c.a.Title,{title:(0,n.localizationKeys)("commerce.subtotal")}),(0,o.tZ)(c.a.Description,{text:`${a.subtotal.currencySymbol}${a.subtotal.amountFormatted}`})]}),s&&(0,o.BX)(c.a.Group,{variant:"tertiary",children:[(0,o.tZ)(c.a.Title,{title:(0,n.localizationKeys)("commerce.creditRemainder")}),(0,o.tZ)(c.a.Description,{text:`- ${a.credit?.currencySymbol}${a.credit?.amountFormatted}`})]}),d&&(0,o.BX)(c.a.Group,{variant:"tertiary",children:[(0,o.tZ)(c.a.Title,{title:(0,n.localizationKeys)("commerce.pastDue")}),(0,o.tZ)(c.a.Description,{text:`${a.pastDue?.currencySymbol}${a.pastDue?.amountFormatted}`})]}),(0,o.BX)(c.a.Group,{borderTop:!0,children:[(0,o.tZ)(c.a.Title,{title:(0,n.localizationKeys)("commerce.totalDueToday")}),(0,o.tZ)(c.a.Description,{text:`${a.totalDueNow.currencySymbol}${a.totalDueNow.amountFormatted}`})]})]})}),!l&&(0,o.tZ)(n.Box,{elementDescriptor:n.descriptors.checkoutFormLineItemsRoot,sx:e=>({paddingBlockStart:e.space.$4,paddingInline:e.space.$4}),children:(0,o.tZ)(n.Text,{localizationKey:(0,n.localizationKeys)("commerce.checkout.downgradeNotice"),variant:"caption",colorScheme:"secondary"})}),(0,o.tZ)(R,{checkout:e})]})}),F=()=>{let{organization:e}=(0,p.o8)(),{subscriberType:t}=(0,a.useCheckoutContext)(),{updateCheckout:r,checkout:o}=g(),i=(0,B.useCardState)();if(!o)throw Error("Checkout not found");let n=async a=>{i.setLoading(),i.setError(void 0);try{let i=await o.confirm({...a,..."org"===t?{orgId:e?.id}:{}});r(i)}catch(e){(0,m.S3)(e,[],i.setError)}finally{i.setIdle()}};return{payWithExistingPaymentSource:async r=>{r.preventDefault();let o=new FormData(r.currentTarget).get("payment_source_id");await n({paymentSourceId:o,..."org"===t?{orgId:e?.id}:{}})},addPaymentSourceAndPay:async r=>{await n({gateway:"stripe",paymentToken:r.stripeSetupIntent?.payment_method,..."org"===t?{orgId:e?.id}:{}})},payWithTestCard:async()=>{i.setLoading(),i.setError(void 0);try{let i=await o.confirm({gateway:"stripe",useTestCard:!0,..."org"===t?{orgId:e?.id}:{}});r(i)}catch(e){(0,m.S3)(e,[],i.setError)}finally{i.setIdle()}}}},R=({checkout:e})=>{let{data:t}=(0,a.usePaymentSources)(),{data:r}=t||{data:[]},[i,c]=(0,l.useState)(()=>r.length>0?"existing":"new");return(0,o.BX)(n.Col,{elementDescriptor:n.descriptors.checkoutFormElementsRoot,gap:4,sx:e=>({padding:e.space.$4}),children:[r.length>0&&e.totals.totalDueNow.amount>0&&(0,o.BX)(v.s.Root,{"aria-label":"Payment method source",value:i,onChange:e=>c(e),size:"lg",fullWidth:!0,children:[(0,o.tZ)(v.s.Button,{value:"existing",text:(0,n.localizationKeys)("commerce.paymentMethods")}),(0,o.tZ)(v.s.Button,{value:"new",text:(0,n.localizationKeys)("commerce.addPaymentMethod")})]}),"existing"===i&&(0,o.tZ)(E,{checkout:e,paymentSources:r,totalDueNow:e.totals.totalDueNow}),"new"===i&&(0,o.tZ)(X,{})]})},T=()=>{let{isLoading:e}=(0,B.useCardState)(),{payWithTestCard:t}=F();return(0,o.BX)(n.Box,{sx:e=>({background:e.colors.$neutralAlpha50,padding:e.space.$2x5,borderRadius:e.radii.$md,borderWidth:e.borderWidths.$normal,borderStyle:e.borderStyles.$solid,borderColor:e.colors.$neutralAlpha100,display:"flex",flexDirection:"column",rowGap:e.space.$2,position:"relative"}),children:[(0,o.tZ)(n.Box,{sx:e=>({position:"absolute",inset:0,background:`repeating-linear-gradient(-45deg,${e.colors.$warningAlpha100},${e.colors.$warningAlpha100} 6px,${e.colors.$warningAlpha150} 6px,${e.colors.$warningAlpha150} 12px)`,maskImage:"linear-gradient(transparent 20%, black)",pointerEvents:"none"})}),(0,o.BX)(n.Flex,{sx:e=>({alignItems:"center",justifyContent:"center",flexDirection:"column",rowGap:e.space.$2}),children:[(0,o.tZ)(n.Text,{sx:e=>({color:e.colors.$warning500,fontWeight:e.fontWeights.$semibold}),localizationKey:(0,n.localizationKeys)("commerce.paymentSource.dev.developmentMode")}),(0,o.tZ)(n.Button,{type:"button",block:!0,variant:"bordered",localizationKey:(0,n.localizationKeys)("userProfile.billingPage.paymentSourcesSection.payWithTestCardButton"),colorScheme:"secondary",isLoading:e,onClick:t})]})]})},X=(0,B.withCardStateProvider)(()=>{let{addPaymentSourceAndPay:e}=F(),{checkout:t}=g();return t?(0,o.BX)(_.fC,{onSuccess:e,checkout:t,children:[(0,o.tZ)(D.P,{children:(0,o.tZ)(T,{})}),t.totals.totalDueNow.amount>0?(0,o.tZ)(_.OL,{text:(0,n.localizationKeys)("commerce.pay",{amount:`${t.totals.totalDueNow.currencySymbol}${t.totals.totalDueNow.amountFormatted}`})}):(0,o.tZ)(_.OL,{text:(0,n.localizationKeys)("commerce.subscribe")})]}):null}),E=(0,B.withCardStateProvider)(({checkout:e,totalDueNow:t,paymentSources:r})=>{let{payWithExistingPaymentSource:i}=F(),a=(0,B.useCardState)(),[c,s]=(0,l.useState)(e.paymentSource||r.find(e=>e.isDefault)),d=(0,l.useMemo)(()=>r.map(e=>{let t="card"!==e.paymentMethod?`${P(e.paymentMethod)}`:`${P(e.cardType)} ⋯ ${e.last4}`;return{value:e.id,label:t}}),[r]);return(0,o.BX)(n.Form,{onSubmit:i,sx:e=>({display:"flex",flexDirection:"column",rowGap:e.space.$4}),children:[e.totals.totalDueNow.amount>0?(0,o.BX)(C.Ph,{elementId:"paymentSource",options:d,value:c?.id||null,onChange:e=>{s(r.find(t=>t.id===e.value))},portal:!0,children:[(0,o.tZ)("input",{name:"payment_source_id",type:"hidden",value:c?.id}),(0,o.tZ)(C.UN,{icon:z.jC,sx:e=>({justifyContent:"space-between",backgroundColor:e.colors.$colorBackground}),children:c&&(0,o.tZ)(K.j,{paymentSource:c})}),(0,o.tZ)(C.pp,{sx:e=>({paddingBlock:e.space.$1,color:e.colors.$colorText})})]}):(0,o.tZ)("input",{name:"payment_source_id",type:"hidden",value:c?.id}),(0,o.tZ)(w.Z.Alert,{children:a.error}),(0,o.tZ)(n.Button,{type:"submit",colorScheme:"primary",size:"sm",textVariant:"buttonLarge",sx:{width:"100%"},isLoading:a.isLoading,children:(0,o.tZ)(n.Text,{localizationKey:t.amount>0?(0,n.localizationKeys)("commerce.pay",{amount:`${t.currencySymbol}${t.amountFormatted}`}):(0,n.localizationKeys)("commerce.subscribe")})})]})});var I=r(9117),L=r(9140);let N=()=>{let{errors:e}=g(),{translateError:t}=(0,n.useLocalizations)(),{t:r}=(0,n.useLocalizations)();return(0,o.tZ)(i.Drawer.Body,{children:(0,o.tZ)(n.Flex,{align:"center",justify:"center",sx:e=>({height:"100%",padding:e.space.$4,fontSize:e.fontSizes.$md}),children:(0,o.tZ)(I.b,{variant:"danger",colorScheme:"danger",children:e?t(e[0]):r((0,n.localizationKeys)("unstable__errors.form_param_value_invalid"))})})})},M=()=>{let{plan:e}=g(),{planPeriod:t}=(0,a.useCheckoutContext)();return e?(0,o.tZ)(i.Drawer.Body,{children:(0,o.BX)(n.Flex,{gap:4,direction:"col",children:[(0,o.tZ)(n.Box,{elementDescriptor:n.descriptors.checkoutFormLineItemsRoot,sx:e=>({padding:e.space.$4,borderBottomWidth:e.borderWidths.$normal,borderBottomStyle:e.borderStyles.$solid,borderBottomColor:e.colors.$neutralAlpha100}),children:(0,o.tZ)(c.a.Root,{children:(0,o.BX)(c.a.Group,{children:[(0,o.tZ)(c.a.Title,{title:e.name,description:"annual"===t?(0,n.localizationKeys)("commerce.billedAnnually"):void 0}),(0,o.tZ)(c.a.Description,{prefix:"annual"===t?"x12":void 0,text:`${e.currencySymbol}${"month"===t?e.amountFormatted:e.annualMonthlyAmountFormatted}`,suffix:(0,n.localizationKeys)("commerce.checkout.perMonth")})]})})}),(0,o.tZ)(n.Box,{sx:e=>({padding:e.space.$4}),children:(0,o.tZ)(I.b,{variant:"info",colorScheme:"info",title:(0,n.localizationKeys)("commerce.cannotSubscribeMonthly")})})]})}):null},U=()=>{let{startCheckout:e}=g(),{setIsOpen:t}=(0,i.useDrawerContext)();return(0,o.tZ)(i.Drawer.Body,{children:(0,o.tZ)(n.Box,{sx:e=>({padding:e.space.$4}),children:(0,o.tZ)(L._,{title:(0,n.localizationKeys)("commerce.checkout.emailForm.title"),subtitle:(0,n.localizationKeys)("commerce.checkout.emailForm.subtitle"),onSuccess:e,onReset:()=>t(!1),disableAutoFocus:!0})})})},G=e=>(0,o.tZ)(n.Flow.Root,{flow:"checkout",children:(0,o.tZ)(n.Flow.Part,{children:(0,o.tZ)(a.SubscriberTypeContext.Provider,{value:e.subscriberType||"user",children:(0,o.tZ)(a.CheckoutContext.Provider,{value:{componentName:"Checkout",...e},children:(0,o.BX)(i.Drawer.Content,{children:[(0,o.tZ)(i.Drawer.Header,{title:(0,n.localizationKeys)("commerce.checkout.title")}),(0,o.BX)(x,{children:[(0,o.tZ)(b,{name:"pending",children:(0,o.tZ)(n.Spinner,{sx:{margin:"auto"}})}),(0,o.tZ)(b,{name:"completed",children:(0,o.tZ)($,{})}),(0,o.tZ)(b,{name:"error",children:(0,o.tZ)(N,{})}),(0,o.tZ)(b,{name:"invalid_plan_change",children:(0,o.tZ)(M,{})}),(0,o.tZ)(b,{name:"missing_payer_email",children:(0,o.tZ)(U,{})}),(0,o.tZ)(b,{name:"ready",children:(0,o.tZ)(A,{})})]})]})})})})})},9140:function(e,t,r){r.d(t,{_:()=>S});var o=r(9109),i=r(3799),a=r(9144),n=r(2672),l=r(431),c=r(9460),s=r(8487),d=r(8969),u=r(111),m=r(1085),p=r(43),h=r(207),y=r(4676),f=r(6917),g=r(9541),k=r(2464);let x=e=>{let{navigate:t}=(0,y.useRouter)(),{email:r,nextStep:i,onReset:l}=e,s=(0,n.useCardState)(),d=(0,u.useUserProfileContext)(),{startEnterpriseSSOLinkFlow:m}=(0,k.eq)(r);async function h(){await t(r.verification.externalVerificationRedirectURL?.href||"")}return a.useEffect(()=>{!function(){let{mode:e,componentName:t}=d;m({redirectUrl:"modal"===e?(0,f.bX)({url:window.location.href,componentName:t}):window.location.href}).then(()=>i()).catch(e=>(0,p.S3)(e,[],s.setError))}()},[]),(0,o.BX)(o.HY,{children:[(0,o.tZ)(g.Flex,{justify:"center",children:(0,o.tZ)(g.Button,{variant:"link",onClick:h,localizationKey:(0,g.localizationKeys)("userProfile.emailAddressPage.enterpriseSSOLink.formButton")})}),(0,o.tZ)(c.K,{children:(0,o.tZ)(g.Button,{variant:"ghost",localizationKey:(0,g.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:g.descriptors.formButtonReset,onClick:l})})]})};var b=r(2786);let S=(0,n.withCardStateProvider)(e=>{let{emailId:t,onSuccess:r,onReset:y,disableAutoFocus:f=!1}=e,g=(0,n.useCardState)(),{user:k}=(0,i.aF)(),S=(0,u.useEnvironment)(),w=(0,i.WZ)(e=>k?.createEmailAddress({email:e})),B=a.useRef(k?.emailAddresses.find(e=>e.id===t)),v=$(B.current,S),C=(0,d.a2)({defaultStep:+!!B.current,onNextStep:()=>g.setError(void 0)}),D=(0,p.Yp)("emailAddress","",{type:"email",label:(0,m.u1)("formFieldLabel__emailAddress"),placeholder:(0,m.u1)("formFieldInputPlaceholder__emailAddress"),isRequired:!0}),z=D.value.length>1&&k?.username!==D.value,_=async e=>{if(e.preventDefault(),k)return w(D.value).then(e=>{B.current=e,C.nextStep()}).catch(e=>(0,p.S3)(e,[D],g.setError))},K=Z(v);return(0,o.BX)(d.en,{...C.props,children:[(0,o.tZ)(s.Y,{headerTitle:e.title||(0,m.u1)("userProfile.emailAddressPage.title"),headerSubtitle:e.subtitle||(0,m.u1)("userProfile.emailAddressPage.formHint"),children:(0,o.BX)(l.l.Root,{onSubmit:_,children:[(0,o.tZ)(l.l.ControlRow,{elementId:D.id,children:(0,o.tZ)(l.l.PlainInput,{...D.props,autoFocus:!f})}),(0,o.tZ)(c.A,{submitLabel:(0,m.u1)("userProfile.formButtonPrimary__add"),isDisabled:!z,onReset:y})]})}),(0,o.BX)(s.Y,{headerTitle:(0,m.u1)("userProfile.emailAddressPage.verifyTitle"),headerSubtitle:(0,m.u1)(`${K}.formSubtitle`,{identifier:B.current?.emailAddress}),children:["email_link"===v&&(0,o.tZ)(b.K,{nextStep:r,email:B.current,onReset:y}),"email_code"===v&&(0,o.tZ)(h.H,{nextStep:r,identification:B.current,identifier:B.current?.emailAddress,prepareVerification:()=>B.current?.prepareVerification({strategy:"email_code"}),onReset:y}),"enterprise_sso"===v&&(0,o.tZ)(x,{nextStep:r,email:B.current,onReset:y})]})]})}),Z=e=>{switch(e){case"email_code":return"userProfile.emailAddressPage.emailCode";case"enterprise_sso":return"userProfile.emailAddressPage.enterpriseSSOLink";case"email_link":return"userProfile.emailAddressPage.emailLink";default:throw Error(`Unsupported strategy for email verification: ${e}`)}},$=(e,t)=>e?.matchesSsoConnection?"enterprise_sso":!function(e){let{userSettings:t}=e,{email_address:r}=t.attributes;return!!(r?.enabled&&r?.verifications.includes("email_link"))}(t)?"email_code":"email_link"},207:function(e,t,r){r.d(t,{H:()=>u});var o=r(9109),i=r(9144),a=r(2667),n=r(2672),l=r(431),c=r(9460),s=r(9541),d=r(43);let u=e=>{let t=(0,n.useCardState)(),{nextStep:r,identification:u,identifier:m,onReset:p,prepareVerification:h}=e,y=()=>h?.()?.catch(e=>d.S3(e,[],t.setError)),f=(0,a.e3)({onCodeEntryFinished:(e,t,r)=>{u?.attemptVerification({code:e}).then(()=>t()).catch(r)},onResendCodeClicked:y,onResolve:r});return i.useEffect(()=>{y()},[]),(0,o.BX)(o.HY,{children:[(0,o.tZ)(l.l.OTPInput,{...f,label:(0,s.localizationKeys)("userProfile.emailAddressPage.emailCode.formTitle"),description:(0,s.localizationKeys)("userProfile.emailAddressPage.emailCode.formSubtitle",{identifier:m}),resendButton:(0,s.localizationKeys)("userProfile.emailAddressPage.emailCode.resendButton"),centerAlign:!1}),(0,o.BX)(c.K,{children:[(0,o.tZ)(s.Button,{isLoading:f.isLoading,localizationKey:(0,s.localizationKeys)("formButtonPrimary__verify"),elementDescriptor:s.descriptors.formButtonPrimary,onClick:f.onFakeContinue}),(0,o.tZ)(s.Button,{variant:"ghost",isDisabled:f.isLoading,localizationKey:(0,s.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:s.descriptors.formButtonReset,onClick:p})]})]})}},2786:function(e,t,r){r.d(t,{K:()=>h,M:()=>y});var o=r(9109),i=r(9144),a=r(2672),n=r(9460),l=r(5495),c=r(8969),s=r(6749),d=r(111),u=r(9541),m=r(2464),p=r(43);let h=e=>{let{email:t,nextStep:r,onReset:c}=e,h=(0,a.useCardState)(),y=(0,d.useUserProfileContext)(),{startEmailLinkFlow:f}=(0,m.E2)(t),{displayConfig:g}=(0,d.useEnvironment)();function k(){let{routing:e}=y,t="virtual"===e?g.userProfileUrl:"";f({redirectUrl:(0,s.Uu)({ctx:y,baseUrl:t,intent:"profile"})}).then(()=>r()).catch(e=>(0,p.S3)(e,[],h.setError))}return i.useEffect(()=>{k()},[]),(0,o.BX)(o.HY,{children:[(0,o.tZ)(l.V,{resendButton:(0,u.localizationKeys)("userProfile.emailAddressPage.emailLink.resendButton"),onResendCodeClicked:k}),(0,o.tZ)(n.K,{children:(0,o.tZ)(u.Button,{variant:"ghost",localizationKey:(0,u.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:u.descriptors.formButtonReset,onClick:c})})]})},y=()=>(0,o.tZ)(c.Ej,{title:(0,u.localizationKeys)("signUp.emailLink.verifiedSwitchTab.title"),subtitle:(0,u.localizationKeys)("signUp.emailLink.verifiedSwitchTab.subtitle"),status:"verified"})}}]);